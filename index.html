<html>
	<head><title>Infinite Fusion Poke Display</title></head>
	<body style=" margin: 0px;">
		<div style="position: fixed; background: gray; padding: 10px; width: 100%; box-sizing: border-box; color: white; display: grid; grid-template-columns: auto auto auto 1fr; grid-gap: 5px; justify-content: center; align-items: center; ">
			<div style="color: white;">View All Custom Sprite Finder</div>
			<select id="pokeID" placeholder='pokemonFusionID'></select>
			<button onclick="startSearch()">Find</button>
			<div style="background: white; height: 20px; border: 2px black solid; border-radius: 4px; overflow: hidden;">
				<div id="loading" style="width: 0%; height: 20px; background: green; transition: width 0.1s;"></div>
			</div>
		</div>
		<div id='main' style='display: grid; grid-template-columns: repeat(auto-fill, 284px); grid-gap: 2px; padding-top: 50px;'> </div>
		<i>
			Thanks for <a href="https://github.com/Aegide/Aegide.github.io">Aegide</a> having the raw spirtes.
			<br>
			The data used is from the game using the art pack (Oct 2022), but is mostly based on generation 5
			The sprites shown here were mostly made by members of the <a href="https://discord.com/invite/2yynWRvBrB">IF Discord</a>,<br>
			with some also coming from the <a href="https://www.reddit.com/r/PokemonInfiniteFusion/">IF Reddit</a>
			community.
		</i>
		v1.3
		<script src="pokeData.js"> </script>
		<script>
			let mainDiv = document.getElementById("main");
			let loadingDiv = document.getElementById("loading");
			let optionDiv = document.getElementById("pokeID");
			ids.forEach(id => {
				let option = document.createElement("option");
				option.value = id[1];
				option.innerHTML = id[0];
				optionDiv.appendChild(option);
			});

			function startSearch() {
				mainDiv.innerHTML = "";
				console.log("starting");
				heavycomp(0);
			}
			function heavycomp(progress) {
				var date = new Date();
				var curDate = null;
				do {
					progress++;
					curDate = new Date();
					searchPokemon(progress);
					if (progress >= 420) {
						loadingDiv.style.width = "100%";
						return;
					}
				}
				while (curDate - date < 100);
				console.log(progress);
				loadingDiv.style.width = Math.round( (progress / 420) * 100 ) + "%";
				setTimeout(() => {
					console.log('progress:' + progress);
					//render()
					heavycomp(progress);
				}, 100);
			}
			//heavycomp( 0 );
			function searchPokemon(index) {
				let firstID = document.getElementById("pokeID").value;

				let url1 = "./CustomBattlers/" + firstID + "." + index + ".png";
				//let url1 = "https://raw.githubusercontent.com/Aegide/custom-fusion-sprites/main/CustomBattlers/" + firstID + "." + index + ".png";
				let url2 = "./CustomBattlers/" + index + "." + firstID + ".png";
				//let url2 = "https://raw.githubusercontent.com/Aegide/custom-fusion-sprites/main/CustomBattlers/" + index + "." + firstID + ".png";
				let url1worker = new Worker("htmlRequest.js");
				url1worker.postMessage(url1)
				url1worker.onmessage = function (d) {
					console.log(d.data);
					createImgDiv(url1, firstID, index);
				}
				let url2worker = new Worker("htmlRequest.js");
				url2worker.postMessage(url2)
				url2worker.onmessage = function (d) {
					console.log(d.data);
					createImgDiv(url2, firstID, index);
				}
				//console.log(url1worker);
				//UrlExists(url1, firstID, index);
				//UrlExists(url2, index, firstID);
				function createImgDiv(URL, id1, id2) {
					console.log(URL);
					let imgcontainer = document.createElement("div");
					let node = document.createElement("img");
					node.src = URL;
					node.alt = index + "." + firstID;
					imgcontainer.appendChild(node);
					let nameText = document.createElement("div");
					nameText.style = "text-align: center; font-weight: 900; font-size: 24px;";
					let name1 = getName(id1);
					let name2 = getName(id2);
					nameText.innerHTML = name1 + "/" + name2;
					imgcontainer.appendChild(nameText);
					mainDiv.appendChild(imgcontainer);
				}
				function getName(index) {
					name = "";
					ids.forEach(id => {
						if (id[1] == index) { name = id[0]; }
					});
					return name;
				}
				
			}
			

		</script>
	</body>
</html>